# generated: 2026-02-20
# project: Cadence
# project_key: NOKEY
# tracking_system: file-system
# story_location: "{project-root}/_bmad-output/implementation-artifacts"

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - ready-for-dev: Story file created in stories folder
#   - in-progress: Developer actively working on implementation
#   - review: Ready for code review
#   - done: Story completed
#   - obsolete: Story superseded by external component (no implementation needed)
#
# CHANGE LOG:
# ===========
# 2026-02-20: Epic 10 NEW - Frontend Screens Implementation (7 stories)
#   - Complete UI implementation matching design prototype (cadence-full-v9.jsx)
#   - Stories: NativeWind Design System, Plan Screen, Coach Screen, Analytics Screen,
#     Settings Screen, Session Screen, Debrief Screen
#   - Depends on: Navigation infrastructure, Auth flow, Mock data layer
# 2026-02-17: Story 4.7 NEW - Data Insights Screen (real data replacing ThinkingDataMock)
#   - Queries activities from Soma via new Convex wrapper
#   - O(n) client-side insight computation (no AI, no backend compute)
#   - Decision tree selects 4-5 emotionally relevant insight lines
#   - Replaces ThinkingDataMock on DATA path in onboarding flow
# 2026-02-17: Epic 9 NEW - Testing Infrastructure & Coverage (9 stories, convex-test for backend)
# 2026-02-17: STATUS CORRECTION - Aligned with epics.md implementationStatus
#   - epics.md shows: completed="1.1-3.5", next="3.6"
#   - Epics 4, 5, 6 corrected from "done" to actual status (backlog/in-progress)
#   - OBSOLETE stories marked distinctly (no implementation needed)
# 2026-02-17: COURSE CORRECTION - Soma component integration reconciliation
#   - Soma component (@nativesquare/soma) supersedes planned Epic 4/5 functionality
#   - Story 4.1: REVISED - Scope reduced ~70%, Soma handles normalization/storage
#   - Story 4.3: OBSOLETE - Superseded by Soma ingest methods
#   - Story 4.4: NEW - Soma Integration Cleanup (delete legacy code)
#   - Story 5.1: OBSOLETE - Soma provides all historical data tables
#   - Story 5.3: OBSOLETE - Soma replaces adapter pattern
#   - Story 5.4: UPDATED - Now reads from Soma tables
#   - Reference: Sprint Change Proposal 2026-02-17
# 2026-02-16: Major epic restructure per epics.md reorganization
#   - Epics reordered by implementation priority
#   - Epic 4: Wearable Data Integration (was Epic 6 partial)
#   - Epic 5: Backend Data Architecture (NEW - split from old structure)
#   - Epic 6: Plan Generation Engine (NEW - split from old structure)
#   - Epic 7: Strava & Additional Wearables (was Epic 6 partial)
#   - Epic 8: Error Handling (was Epic 5)
#   - Epic 9: Trial & Paywall (was Epic 4 partial)
#   - Stories 3.6-3.10 added for AI infrastructure completion
# 2026-02-14: Sprint Change Proposal approved - UI-first approach
#   - Stories 2-8 to 2-13 REWRITTEN for UI components with mock data
#   - Epic 3 REVISED: visualization UI first, then backend wiring
#   - Reference: sprint-change-proposal-2026-02-14.md

generated: 2026-02-20
project: Cadence
project_key: NOKEY
tracking_system: file-system
story_location: "{project-root}/_bmad-output/implementation-artifacts"

# CURRENT IMPLEMENTATION STATUS (per epics.md):
# completed: Stories 1.1 - 3.5
# next: Story 3.6 (Server-Side Tool Execution)
# current_gap: Streaming UI works with mock data, but server-side tool execution not implemented

development_status:
  # ==========================================================================
  # Epic 1: Foundation & Runner Object Setup - IMPLEMENTED
  # ==========================================================================
  # User can sign up/login via social login, confirm identity, track progress
  # FRs: FR1, FR2, FR4, FR5, FR48, FR49, FR50, FR51
  epic-1: done
  1-1-runner-object-schema-crud: done
  1-2-social-login-integration: done
  1-3-onboarding-consent-flow: done
  1-4-health-data-consent: done
  1-5-name-confirmation-screen: done
  1-6-progress-tracking-persistence: done

  # ==========================================================================
  # Epic 2: Conversational Profile Building - IMPLEMENTED
  # ==========================================================================
  # User engages in conversation, answers via multiple modes, builds profile
  # FRs: FR13-FR21, FR25, FR28-FR37
  epic-2: done
  2-1-ai-sdk-integration-streaming-infrastructure: done
  2-2-generative-ui-tool-renderer: done
  2-3-multiple-choice-input-tool: done
  2-4-open-text-input-tool: done
  2-5-voice-input-capability: done
  2-6-confirmation-card-tool: done
  2-7-wearable-connection-mock-skip-path: done
  2-8-design-tokens-animation-alignment: done
  2-9-streaming-text-cursor-polish: done
  2-10-freeform-input-mini-analysis: done
  2-11-choice-cards-confidence-badge: done
  2-12-conversation-screen-flow-mock: done
  2-13-transition-loading-states: done

  # ==========================================================================
  # Epic 3: Plan Generation & Visualization - PARTIAL
  # ==========================================================================
  # UI components with mock data (3.1-3.5 DONE)
  # Backend wiring & AI infrastructure (3.6-3.10 NOT STARTED)
  # FRs: FR38-FR47
  epic-3: in-progress
  # --- UI COMPONENTS (DONE) ---
  3-1-radarchart-component: done
  3-2-progressionchart-component: done
  3-3-calendarwidget-component: done
  3-4-verdict-screen-decision-audit: done
  3-5-full-screen-flow-integration-mock: done
  # --- AI INFRASTRUCTURE (CRITICAL GAP) ---
  3-6-server-side-tool-execution-agentic-loop: ready-for-dev  # Story created 2026-02-16
  3-7-tool-result-handler-runner-object-updates: ready-for-dev  # Story created 2026-02-16
  3-8-conversation-phase-management: ready-for-dev  # Story created 2026-02-16
  3-9-backend-wiring-visualization-data: ready-for-dev  # Story created 2026-02-16
  3-10-adaptive-coaching-language: backlog

  # ==========================================================================
  # Epic 4: Wearable Data Integration - HIGH PRIORITY
  # ==========================================================================
  # HealthKit (iOS), mock data providers
  # FRs: FR7, FR9, FR10, FR11
  # NOTE (2026-02-17): Soma component handles normalization/storage
  #   - Story 4.1: REVISED - native extraction only, Soma handles rest
  #   - Story 4.3: OBSOLETE - superseded by Soma ingest methods
  #   - Story 4.4: NEW - cleanup legacy code (HIGH PRIORITY)
  epic-4: in-progress
  4-1-healthkit-integration-ios: done  # REVISED: Native extraction only, Soma handles rest. Code review fixes applied 2026-02-17.
  4-2-mock-data-providers-development: review  # Mock data generator and seed mutations implemented 2026-02-17
  4-3-data-normalization-sync-pipeline: obsolete  # Superseded by Soma ingest methods
  4-4-soma-integration-cleanup: done  # Legacy code deleted, native app migrated to Soma endpoints, code review fixes applied 2026-02-17
  4-5-soma-table-schema-cleanup: done  # Tables deleted, schema updated. 4.6 complete, no longer blocked.
  4-6-inference-engine-soma-migration: done  # Completed 2026-02-17: Refactored inference engine to use Soma API
  4-7-data-insights-screen: done  # Completed 2026-02-17: Real data insights replacing ThinkingDataMock, queries Soma activities, O(n) client-side computation

  # ==========================================================================
  # Epic 5: Backend Data Architecture - HIGH PRIORITY
  # ==========================================================================
  # Historical data tables (Soma), enhanced Runner Object, inference engine
  # FRs: FR22, FR23, FR24 (backend implementation)
  # Reference: data-model-comprehensive.md, architecture-backend-v2.md
  # NOTE (2026-02-17): Soma provides historical data tables and adapter functionality
  #   - Story 5.1: OBSOLETE - Soma provides activities, sleepSessions, dailySummaries, bodyMeasurements
  #   - Story 5.3: OBSOLETE - Soma replaces adapter pattern with ingest methods
  epic-5: backlog
  5-1-historical-data-tables-schema: obsolete  # Provided by Soma component
  5-2-enhanced-runner-object-provenance: ready-for-dev  # Cadence-specific, STILL NEEDED
  5-3-data-adapters-pattern: obsolete  # Superseded by Soma ingest methods
  5-4-inference-engine-current-state: review  # Tests added 2026-02-17, ready for code review

  # ==========================================================================
  # Epic 6: Plan Generation Engine - DONE
  # ==========================================================================
  # Knowledge base, safeguards, plan generator with multi-level justifications
  # FRs: FR38, FR39, FR40, FR44, FR45 (backend implementation)
  # NOTE (2026-02-17): All stories verified complete per implementation artifacts
  #   - Not impacted by Soma integration (separate concerns)
  #   - Plan Generator receives Runner Object, generates plans
  epic-6: done
  6-1-training-plans-multi-level-zoom-schema: done
  6-2-planned-sessions-schema: done
  6-3-knowledge-base-infrastructure: done
  6-4-safeguards-system: done
  6-5-plan-generator-core: done
  6-6-plan-to-ui-data-queries: done

  # ==========================================================================
  # Epic 7: Strava & Additional Wearable Connections - MEDIUM PRIORITY
  # ==========================================================================
  # Strava OAuth, Health Connect (Android), Thinking Stream analysis
  # FRs: FR6, FR8, FR12, FR26, FR27
  epic-7: backlog
  7-1-strava-oauth-integration: backlog
  7-2-strava-activity-sync: backlog
  7-3-health-connect-integration-android: backlog
  7-4-thinking-stream-analysis-display: backlog

  # ==========================================================================
  # Epic 8: Error Handling & Resilience - DONE
  # ==========================================================================
  # Network handling, connection recovery, LLM fallbacks, permission guidance
  # FRs: FR56, FR57, FR58, FR59
  epic-8: done
  8-1-network-unavailable-handling: done  # Completed 2026-02-17
  8-2-connection-lost-mid-flow: done  # Completed 2026-02-17
  8-3-llm-failure-fallback: done  # Completed 2026-02-17: Error classification, retry UI, exhausted retries handling
  8-4-permission-denied-guidance: done  # Completed 2026-02-17: PermissionDeniedCard, HealthKit/mic integration

  # ==========================================================================
  # Epic 9: Testing Infrastructure & Coverage - HIGH PRIORITY (NEW)
  # ==========================================================================
  # Framework setup and test coverage for backend and native app
  # NFRs: NFR-R1, NFR-R2, NFR-R3 (reliability validation)
  # Reference: 9-0-testing-infrastructure-epic.md
  epic-9: backlog
  9-1-convex-backend-test-setup: backlog  # convex-test (uses vitest internally)
  9-2-native-app-test-framework-setup: backlog  # jest + react-native-testing-library
  9-3-monorepo-test-integration: backlog  # turbo test tasks
  9-4-ai-streaming-test-suite: backlog  # SSE, auth, tool calls, errors
  9-5-tool-execution-test-suite: backlog  # handlers, field mapping, provenance
  9-6-inference-engine-test-validation: backlog  # existing tests + Soma adapter
  9-7-onboarding-flow-test-suite: backlog  # native screens, flows, persistence
  9-8-generative-ui-component-tests: backlog  # all tool components + charts
  9-9-mock-utilities-test-fixtures: backlog  # shared mocks, factories, fixtures
  epic-9-retrospective: optional

  # ==========================================================================
  # Epic 10: Frontend Screens Implementation - DRAFT
  # ==========================================================================
  # Complete app UI screens matching design prototype (cadence-full-v9.jsx)
  # FRs: UI implementation for Plan, Coach, Analytics, Settings, Session, Debrief
  # Reference: 10-0-frontend-screens-epic.md
  # Dependencies: Navigation infrastructure, Authentication flow, Mock data layer
  epic-10: in-progress
  10-1-system-design-cleanup-nativewind: review  # Foundation: design tokens, Tailwind config. Completed 2026-02-20.
  10-2-plan-screen-home-today-tab: ready-for-dev  # Primary entry point, calendar strip, session cards. Story created 2026-02-20.
  10-3-coach-screen-chat-tab: ready-for-dev  # Story created 2026-02-20, comprehensive dev guide
  10-4-analytics-screen-analytics-tab: review  # Charts, histograms, plan progress. Completed 2026-02-20.
  10-5-settings-screen-profile-tab: review  # Completed 2026-02-20: Profile screen with progress ring, connected services, settings
  10-6-session-screen-active-workout: ready-for-dev  # Story created 2026-02-20: Session Detail (pre-workout) comprehensive dev guide
  10-7-debrief-screen-post-workout: ready-for-dev  # Story created 2026-02-20. Session summary, feeling selector, coach streaming response.
  10-8-session-debrief-screen: ready-for-dev  # Story created 2026-02-20: Feeling selector, coach streaming response, celebration trigger
  10-9-celebration-overlay: ready-for-dev  # Story created 2026-02-20. Animation overlay on session complete.
  epic-10-retrospective: optional

# ==========================================================================
# IMPLEMENTATION SEQUENCE (from epics.md, updated 2026-02-20)
# ==========================================================================
# SOMA INTEGRATION IMPACT (Sprint Change Proposal 2026-02-17):
#   Stories obsoleted: 3 (4.3, 5.1, 5.3)
#   Stories revised: 1 (4.1 - scope reduced ~70%)
#   New stories: 1 (4.4 Cleanup)
#   Net effort savings: ~4 days
#
# Phase 0: Testing Framework Setup (Epic 9, Stories 9.1-9.3) ← RECOMMENDED FIRST
#   Goal: Enable automated testing before adding more features
#   - Story 9.1: Convex backend test setup (convex-test, uses vitest internally)
#   - Story 9.2: Native jest setup (unblocks component tests)
#   - Story 9.3: Monorepo turbo integration
#   NOTE: Framework setup can run in parallel with Phase 1
#
# Phase 1: Complete the AI Loop (Stories 3.6-3.8) ← CURRENT PRIORITY
#   Goal: Tool calls actually save data and conversation continues
#
# Phase 2: Soma Cleanup & Wearable Foundation (Epic 4)
#   Goal: Clean codebase, HealthKit works, mock data available
#   - Story 4.4: Soma Integration Cleanup (delete legacy code) ← DONE
#   - Story 4.1: HealthKit Integration (REVISED - native extraction only) ← DONE
#   - Story 4.2: Mock Data Providers ← IN REVIEW
#   - Story 4.3: OBSOLETE (Soma provides)
#   - Story 4.7: Data Insights Screen (real data in onboarding) ← DONE
#
# Phase 3: Backend Infrastructure (Epic 5)
#   Goal: Runner Object enhanced, current state calculated from Soma tables
#   - Story 5.1: OBSOLETE (Soma provides tables)
#   - Story 5.2: Enhanced Runner Object with Provenance
#   - Story 5.3: OBSOLETE (Soma provides adapters)
#   - Story 5.4: Inference Engine (reads Soma tables → writes runners.currentState)
#
# Phase 4: Plan Generation (Epic 6)
#   Goal: Plans generated with full justifications
#
# Phase 5: Wire Visualizations (Stories 3.9-3.10)
#   Goal: Charts show real data
#
# Phase 6: Additional Wearables (Epic 7)
#   Goal: Strava, Health Connect, Thinking Stream
#   NOTE: Soma already handles Strava OAuth/sync - verify scope of 7.1/7.2
#
# Phase 7: Polish (Epic 8)
#   Goal: Error handling
#
# TESTING COVERAGE (Epic 9 Stories 9.4-9.9):
#   Recommended: Add test suites as each phase completes
#   - After Phase 1: Story 9.4 (AI Streaming), Story 9.5 (Tool Execution)
#   - After Phase 3: Story 9.6 (Inference Engine Validation)
#   - Parallel with Phase 5: Story 9.7 (Onboarding), Story 9.8 (Generative UI)
#   - Any time: Story 9.9 (Mock Utilities)
#
# Phase 8: Frontend Screens (Epic 10) ← NEW
#   Goal: Complete polished app UI matching design prototype
#   Dependencies: Phase 1 complete (navigation), Phase 4 complete (plan data)
#   Recommended sequence (from epic file):
#     1. Story 10.1: NativeWind Design System (FIRST - establishes foundation)
#     2. Story 10.2: Plan Screen (primary entry point, most complex)
#     3. Story 10.5: Settings Screen (validates design system)
#     4. Story 10.4: Analytics Screen (charts, validates animation patterns)
#     5. Story 10.3: Coach Screen (chat UI patterns)
#     6. Story 10.6: Session Screen (requires Plan for navigation)
#     7. Story 10.7: Debrief Screen (requires Session for flow)
